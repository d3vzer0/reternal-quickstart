# Example compose file starting all reternal components
# Binds all interface on localhost with their default ports in a custom rtrnal network
#
# WARNING: This is compose uses the Development branch. Some components
# do not have authentication enabled yet (mongodb, redis).
# Don't be silly and run this when you didn't review this file >:(

version: '2'
services:
  mongodb:
    image: mongo
    networks:
      - rtn-backend
    ports:
      - "127.0.0.1:27017:27017"
    volumes:
      - empire-data:/data/db

  redis:
    image: redis
    networks:
      - rtn-backend
    ports:
      - "127.0.0.1:6379:6379"

  api:
    image: reternal/api
    networks:
      - rtn-backend
    ports:
      - "127.0.0.1:5000:5000"

  c2:
    image: reternal/c2
    environment:
      # Replace below with something unique, also change for the empire service
      - RT_EMPIRE_PASSWORD=l0ld4tuken0bi
      - RT_EMPIRE_USERNAME=h3ll0there
    networks:
      - rtn-backend    

  # Soon (tm)
  # filebeat:
  #   image: docker.elastic.co/beats/filebeat:7.6.1
  #   networks:
  #     - rtn-backend
  #   volumes:
  #     - "empire-data:/opt/Empire:ro"
  #     - "./filebeat.yml:/usr/share/filebeat/filebeat.yml:ro"

  empire:
    image: empireproject/empire:latest
    # Change command to match the empire password
    command: /bin/sh -c "cd setup && ./cert.sh && pip install pefile requests && cd ../ && ./empire --username h3ll0there --password l0ld4tuken0bi --headless --debug"
    volumes:
      - "empire-data:/opt/Empire:rw"
    expose:
      - 1337
    ports:
      - '127.0.0.1:1337:1337'
    networks:
      - rtn-backend

  # Test machine to deploy payload :)
  # victim:
  #   image: python:2.7.17-slim
  #   command: /bin/sh -c "while sleep 1000; do :; done"
  #   networks:
  #     - rtn-backend

volumes:
  empire-data:
  mongodb-data:
      
networks:
  rtn-backend:
    driver: bridge
